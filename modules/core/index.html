<!DOCTYPE html>
<html class="no-js">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Core Modules  &middot; Yarra Framework</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="">

<meta property="og:title" content="Core Modules  &middot; Yarra Framework ">
<meta property="og:site_name" content="Yarra Framework"/>
<meta property="og:url" content="http://yarra-framework.org/modules/core/" />
<meta property="og:locale" content="en-us">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2018-06-15T00:00:00Z" />
<meta property="og:article:modified_time" content="2018-06-15T00:00:00Z" />

  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Core Modules",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2018-06-15",
    "description": "",
    "wordCount":  77 
  }
</script>


<link rel="canonical" href="http://yarra-framework.org/modules/core/" />

<meta name="generator" content="Hugo 0.104.3" />


  <link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="stylesheet" href="/assets/css/yarra.css">

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-63470225-3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-63470225-3');
  </script>

</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top site-navbar navbar-inverse">
  <a class="navbar-brand text-white" href="http://yarra-framework.org/">Yarra Framework</a>
  <button class="navbar-toggler text-white" 
  type="button" data-toggle="collapse" data-target="#exCollapsingNavbar2" aria-controls="exCollapsingNavbar2"
    aria-expanded="false" aria-label="Toggle navigation">
    &#9776;
  </button>
  <div class="collapse navbar-collapse" id="exCollapsingNavbar2">
    <ul class="nav navbar-nav ml-1 mr-auto">
               
        
        <li class="nav-item">
          <a class="nav-link menu-item " href="/overview/">
            
            <span class="text-capitalize no-decoration text-white">Overview</span>
          </a>
        </li>
        
              
        
        <li class="nav-item">
          <a class="nav-link menu-item " href="/clients/">
            
            <span class="text-capitalize no-decoration text-white">Clients</span>
          </a>
        </li>
        
              
        
        <li class="nav-item">
          <a class="nav-link menu-item " href="/server/">
            
            <span class="text-capitalize no-decoration text-white">Server</span>
          </a>
        </li>
        
              
        
        <li class="nav-item">
          <a class="nav-link menu-item active" href="/modules/">
            
            <span class="text-capitalize no-decoration text-white">Modules</span>
          </a>
        </li>
        
              
        
        <li class="nav-item">
          <a class="nav-link menu-item " href="/logserver/">
            
            <span class="text-capitalize no-decoration text-white">LogServer</span>
          </a>
        </li>
        
              
        
        <li class="nav-item">
          <a class="nav-link menu-item " href="/addons/">
            
            <span class="text-capitalize no-decoration text-white">Addons</span>
          </a>
        </li>
        
              
        
        <li class="nav-item">
          <a class="nav-link menu-item " href="/download/">
            
            <span class="text-capitalize no-decoration text-white">Download</span>
          </a>
        </li>
        
              
        
        <li class="nav-item">
          <a class="nav-link menu-item " href="/blog/">
            
            <span class="text-capitalize no-decoration text-white">Blog</span>
          </a>
        </li>
        
              
        
              
        
              
        
      
    </ul>
  </div>
</nav>


<div class="container p-a-0">
  <div class="row m-l-0 m-r-0 mb-2">
    <div class="col">
      <h1>Modules&nbsp;-&nbsp;Core Modules</h1>
    </div>
  </div>
    <div class="row m-l-0 m-r-0">
      <div class="col-xs-12 col-lg-3">
      <div class="list-group mr-3 mb-4">
        <a href="http://yarra-framework.org/modules/" class="list-group-item list-group-item-action">Overview</a>
        
        
        
        <a href="/modules/core/" class="list-group-item list-group-item-action active">&ndash;&nbsp; Core Modules</a>
        
        <a href="/modules/user/" class="list-group-item list-group-item-action ">&ndash;&nbsp; User Modules</a>
        
        <a href="/modules/development/" class="list-group-item list-group-item-action ">&ndash;&nbsp; Development</a>
        
        <a href="/modules/packaging/" class="list-group-item list-group-item-action ">&ndash;&nbsp; Packaging</a>
        
      </div>
    </div>
    <div class="col-xs-12 col-lg-9 post-container">
      <div class="content pt-2">
  <h3 id="hahahugoshortcode-s0-hbhb">
<i class="fas fa-angle-double-right" style="color: #580F8B; font-size: 24px;">&nbsp;</i>Included Core Modules

</h3>
<p>The following &ldquo;core&rdquo; modules are included in the YarraServer installation package. The binaries are located in the folder <strong>yarra/modules</strong>. They can be referenced using the helper macro <strong>%bd</strong>. Sometimes, beta versions of updated core modules are released. It is possible to install these versions as user modules in parallel to the version that  comes with the YarraServer release (in this case, the macro for calling the modules has to be replaced by %bu).</p>
<div style="margin-bottom: 20px; font-size: 0px;">&nbsp;</div>

</div>

      
      


      <div class="card" style="margin-top: 10px;">
        <a  class="faq" data-toggle="collapse" data-target="#itemfb3b5de1de6185c6638205c5a485776c"><div style="margin-left: 8px; margin-right: 8px; margin-top: 4px; margin-bottom: 4px;"><i class="fas fa-angle-right"></i>&nbsp;DriveTransfer&nbsp;
        <span style="float: right; background-color: #E0A526" 
        class="badge badge-primary">Transfer</span></div></a>
        <div id="itemfb3b5de1de6185c6638205c5a485776c" class="collapse">
          <div style="margin: 8px;">
            <div class="">            
              Author:  Kai Tobias Block <br>
              Version: 0.11b6 <br>
              
              <hr>                
            </div>   
            <div class="">
              <div class="content pt-2">
  <h4 id="purpose">Purpose</h4>
<p>Transfers reconstructed DICOM images onto a network share (or mounted disk drive).</p>
<h4 id="usage">Usage</h4>
<pre tabindex="0"><code>DriveTransfer [mode file] [directory with DICOMs] [unique task name]
</code></pre><p>Typical call:</p>
<pre tabindex="0"><code>[Transfer]
Bin=%bd/DriveTransfer
Args=%mc %td %vuid
</code></pre><h4 id="configuration">Configuration</h4>
<p>In .mode file:</p>
<pre tabindex="0"><code>[DriveTransfer]
TargetPath=#Path to target location, e.g. /media/yarra_out
</code></pre>
</div>
          
            </div>            
            </div>
        </div>
     </div>
    
        
      


      <div class="card" style="margin-top: 10px;">
        <a  class="faq" data-toggle="collapse" data-target="#item58b53a960d6c4968596301aa115c8e38"><div style="margin-left: 8px; margin-right: 8px; margin-top: 4px; margin-bottom: 4px;"><i class="fas fa-angle-right"></i>&nbsp;IniPatch&nbsp;
        <span style="float: right; background-color: #489FDF" 
        class="badge badge-primary">Preprocessing</span></div></a>
        <div id="item58b53a960d6c4968596301aa115c8e38" class="collapse">
          <div style="margin: 8px;">
            <div class="">            
              Author:  Kai Tobias Block <br>
              Version: 0.12 <br>
              
              <hr>                
            </div>   
            <div class="">
              <div class="content pt-2">
  <h4 id="purpose">Purpose</h4>
<p>Creates a “patched” copy of a source ini file in the work directory with the given name. All keys specified in the mode file will be replaced by the param value passed as 4th argument, or by statically defined values written into the mode file.</p>
<h4 id="usage">Usage</h4>
<pre tabindex="0"><code>IniPatch [mode file] [source ini file] [target (in work dir)] [param value]
</code></pre><p>Typical call:</p>
<pre tabindex="0"><code>[PreProcessing]
Bin=%bd/IniPatch
Args=%mc %md/template.ini %rid/settings.ini %vparam
</code></pre><h4 id="configuration">Configuration</h4>
<p>In .mode file:</p>
<pre tabindex="0"><code>[IniPatch]
PatchKey1=#Name of entry to patch in format section/entry, e.g. Preprocessing/SpokesPerFrame1
PatchKey2=#Name of 2nd entry to patch
PatchKey3=#Name of addition entry (up to 50 possible)
 
[IniPatch_static]
Section/Key=Value
AnotherSection/AnotherKey=AnotherValue
</code></pre><p>The section [IniPatch] defines those keys that should be overwritten (dynamically) with the value passed as 4th function argument. The section [IniPatch_static] can be used to define a number of keys that are overwritten by fixed values. An unlimited number of keys can be defined using the notation SectionName/KeyName=Value.</p>

</div>
          
            </div>            
            </div>
        </div>
     </div>
    
        
      


      <div class="card" style="margin-top: 10px;">
        <a  class="faq" data-toggle="collapse" data-target="#item0a0f92433ea91eeab00af99d1e32c5c1"><div style="margin-left: 8px; margin-right: 8px; margin-top: 4px; margin-bottom: 4px;"><i class="fas fa-angle-right"></i>&nbsp;SetDCMTags&nbsp;
        <span style="float: right; background-color: #40C1AC" 
        class="badge badge-primary">Postprocessing</span></div></a>
        <div id="item0a0f92433ea91eeab00af99d1e32c5c1" class="collapse">
          <div style="margin: 8px;">
            <div class="">            
              Author:  Kai Tobias Block <br>
              Version: 0.1b9 <br>
              
              <hr>                
            </div>   
            <div class="">
              <div class="content pt-2">
  <h4 id="purpose">Purpose</h4>
<p>Populates the DICOM tags of reconstructed images based on patient and scan information read from the Twix file. It also combines DICOM files into series based on the file name and sets the needed DICOM UUIDs.</p>
<h4 id="usage">Usage</h4>
<pre tabindex="0"><code>SetDCMTags [options] input output rawfile
</code></pre><p>Parameters:<br></p>
<pre tabindex="0"><code>  input   -- Folder with DICOM files to process
  output  -- Folder where modified DICOM files will be written
  rawfile -- Path and name of raw-data file
</code></pre><p>Options:<br></p>
<pre tabindex="0"><code>  -a -- Accession number
  -t -- Path and name of task file
  -m -- Path and name of mode file
  -d -- Path and name of dynamic settings
  -l -- Extended log output for debugging
  -v -- Show version information and exit
</code></pre><p>Typical call:</p>
<pre tabindex="0"><code>[PostProcessing]
Bin=%bd/SetDCMTags
Args=%pid %pod %rid/%rif -a %vacc -m %mc -t %rid/rit
</code></pre><h4 id="configuration">Configuration</h4>
<h5 id="file-naming-convention">File naming convention</h5>
<p>In order for SetDCMTags to correctly group images into series, the DICOMs written by the reconstruction module have to be named according to the syntax:</p>
<pre tabindex="0"><code>series{n}.slice{m}.dcm
</code></pre><p>where <em>{n}</em> is the series # (e.g. time point, in case of 4D MRI data) and <em>{m}</em> is the slice number.</p>
<h5 id="global-options">Global options</h5>
<p>The following settings can be defined in the [SetDCMTags] section of the .mode file:</p>
<pre tabindex="0"><code>[SetDCMTags]
SeriesOffset=        // Adds an offset to the series number
Color=               // Set to TRUE if the images are color images
ClearDefaults=       // Set to TRUE if the default tag assignment should not be used
SeriesMode=          // Set to TIME for 4D scans (i.e. if series are different time points)
FrameDuration=       // Defines the duration of one frame of the 4D dataset (in ms)
TimeOffset=          // Adds a time offset for the first frame (in ms)
InterleaveSeries=    // Set to TRUE if the order of series/slices should be swapped
StackSeries=         // Set to TRUE is all images should be stacked in one series
</code></pre><h5 id="adding-or-overwriting-tags">Adding or overwriting tags</h5>
<p>SetDCMTags sets most DICOM tags automatically. However, it is possible to overwrite the default assignment or to set additional tags:</p>
<pre tabindex="0"><code>[SetDCMTags]
(n,m)=value
</code></pre><p>where <em>n</em>,<em>m</em> specifies the ID of the tag (see a list of all available DICOM tags <a href="https://www.dicomlibrary.com/dicom/dicom-tags/">here</a>).</p>
<p>Various macros can be used for setting the tags. Using the <strong>@</strong> operator, it is possible to reference values from the Twix file. For example, <strong>@PatientName</strong> returns the patient name. Values contained in the measurement protocol can be referenced using <strong>@mrpot</strong>. For example, <strong>@mrprot.adFlipAngleDegree[0]</strong> returns the flip angle of the first pulse. The original value of the DICOM tag can be accessed via <strong>#keep</strong> (thus, using #keep will preserve the original value instead of overwriting the DICOM tag).</p>
<p>Using the <strong>#</strong> operator, it is possible to access helper variables that are calculated by SetDCMTags. For example, <strong>#series</strong> returns the current series number. Using the <strong>$</strong> operator, helper functions can be called for manipulating the value: <strong>$EXT</strong> allows appending information. For example, <strong>$EXT(@ProtocolName,_modified)</strong> appends the string &ldquo;_modified&rdquo; to the protocol name. <strong>$DIV</strong> divides the value by an integer (as, e.g., needed when converting between ms and sec). For example, <strong>$DIV(@mrprot.alTE[0],1000,2)</strong> divides the TE time from the protocol by 1000 and keeps 2 digits.</p>
<p>The list of available helper variables can be seen in <a href="https://bitbucket.org/yarra-dev/yarramodules-setdcmtags/src/master/sdt_global.h">this file</a>, while the list of values parsed from the Twix file can be found on the bottom of <a href="https://bitbucket.org/yarra-dev/yarramodules-setdcmtags/src/master/sdt_twixreader.cpp">this file</a>. The default assignment that SetDCMTags uses can be seen in <a href="https://bitbucket.org/yarra-dev/yarramodules-setdcmtags/src/master/sdt_tagmapping.cpp">this file</a>.</p>
<h5 id="setting-series-specific-tags">Setting series-specific tags</h5>
<p>The values defined in the [SetDCMTags] section will be appied to all series. It is also possible to define values only for certain series. This can be done by adding a section to the .mode file where the series number is appended to the section name. In the following example, these settings would only be applied to series 2:</p>
<pre tabindex="0"><code>[SetDCMTags_Series2]
(0008,103E)=$EXT(inphase_,@ProtocolName)
</code></pre><h5 id="setting-tags-dynamically">Setting tags dynamically</h5>
<p>Settings for SetDCMTags can be written into the .mode file, so that different settings can be defined for every reconstruction mode. However, sometimes it is necessary to set DICOM tags depending on the result of the indiviudal reconstruction. This is possible by writing these dynamic settings into a new text file that is created by the reconstruction module in the &ldquo;work&rdquo; folder %rid (where also the raw-data file is located). The name of the file has to be passed to SetDCMTags via the <em>-d</em> option. SetDCMTags then reads these settings as last step (overwriting all previously defined settings).</p>

</div>
          
            </div>            
            </div>
        </div>
     </div>
    
        
      


      <div class="card" style="margin-top: 10px;">
        <a  class="faq" data-toggle="collapse" data-target="#item8f1ba51fa5b6ad1b1322aa9c0a53a1c0"><div style="margin-left: 8px; margin-right: 8px; margin-top: 4px; margin-bottom: 4px;"><i class="fas fa-angle-right"></i>&nbsp;PACSTransfer&nbsp;
        <span style="float: right; background-color: #E0A526" 
        class="badge badge-primary">Transfer</span></div></a>
        <div id="item8f1ba51fa5b6ad1b1322aa9c0a53a1c0" class="collapse">
          <div style="margin: 8px;">
            <div class="">            
              Author:  Kai Tobias Block <br>
              Version: 0.4g <br>
              
              <hr>                
            </div>   
            <div class="">
              <div class="content pt-2">
  <h4 id="purpose">Purpose</h4>
<p>Sends all reconstructed DICOM images to one or multiple DICOM nodes (PACS or DICOM workstation).
Requires installation of the OFFIS dcmtk package on the server.</p>
<h4 id="usage">Usage</h4>
<pre tabindex="0"><code>PACSTransfer [mode file] [directory with DICOMs]
</code></pre><p>Typical call:</p>
<pre tabindex="0"><code>[Transfer]
Bin=%bd/PACSTransfer
Args=%mc %td
</code></pre><h4 id="configuration">Configuration</h4>
<p>In .mode file:</p>
<pre tabindex="0"><code>[PACSTransfer]
AEC=#AEC of PACS
IP=#IP of PACS, e.g. 10.142.23.54
Port=#Port of PACS, e.g. 104
AET=#AET to be used, e.g. YARRA
</code></pre><p>If the images should be sent to multiple DICOM nodes (up to 20), add to .mode file:</p>
<pre tabindex="0"><code>[PACSTransfer]
AEC_1=#AEC of PACS 1
IP_1=#IP of PACS 1, e.g. 10.142.23.54
Port_1=#Port of PACS 1, e.g. 104
AET_1=#AET to be used, e.g. YARRA
 
AEC_2=#AEC of PACS 2
IP_2=#IP of PACS 2, e.g. 10.142.23.54
Port_2=#Port of PACS 2, e.g. 104
AET_2=#AET to be used, e.g. YARRA
</code></pre><p>By default, the PACSTransfer module sends the images one file at a time in the right series order. This is required for some of the PACS systems to ensure that the series are correctly ordered. However, sometimes it is also necessary to send the whole directory all at once (e.g., for recent Syngo.via versions). The latter can be enforced by writing the statement <strong>DirMode=true</strong> into the respective PACS section (i.e. if multple nodes are used, use DirMode_n=true respectively).</p>

</div>
          
            </div>            
            </div>
        </div>
     </div>
    
        
      

      
    </div>
  </div>
</div>
      <a href="https://github.com/orgs/yarra-framework/discussions" target="_none" class="chat-button">Open Chat</a>
<footer style="margin-top: 100px;">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <ul class="list-inline pull-left">
                    
                         
                         
                          <li><a class="page-scroll" href="/">Home</a></li>
                          <li class="footer-menu-divider">&vert;</li> 
                        
                          <li><a class="page-scroll" href="/disclaimer/">Disclaimer</a></li>
                          <li class="footer-menu-divider">&vert;</li> 
                        
                          <li><a class="page-scroll" href="/license/">License</a></li>
                           
                         
                    
                </ul>
            </div>
            <div class="col-md-4">
            <div class="pull-right">
            <a href="http://cai2r.net" target="_blank"><img class="cai2rlogo" src="/assets/img/cai2r.png" height="65"></a>
            </div>
            </div>
        </div>
    </div>
</footer>

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha256-xaF9RpdtRxzwYMWg4ldJoyPWqyDPCRD0Cv7YEEe6Ie8=" crossorigin="anonymous"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>

<script>
hljs.configure({
  languages: []
})
hljs.initHighlightingOnLoad();
</script>

<script src="/assets/js/script.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">


  </body>
</html>

