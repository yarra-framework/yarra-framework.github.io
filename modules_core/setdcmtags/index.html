<!DOCTYPE html>
<html class="no-js">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SetDCMTags  &middot; Yarra Framework</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="">

<meta property="og:title" content="SetDCMTags  &middot; Yarra Framework ">
<meta property="og:site_name" content="Yarra Framework"/>
<meta property="og:url" content="http://yarra-framework.org/modules_core/setdcmtags/" />
<meta property="og:locale" content="en-us">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2018-06-15T00:00:00Z" />
<meta property="og:article:modified_time" content="2018-06-15T00:00:00Z" />

  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "SetDCMTags",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2018-06-15",
    "description": "",
    "wordCount": 709
  }
</script>


<link rel="canonical" href="http://yarra-framework.org/modules_core/setdcmtags/" />

<meta name="generator" content="Hugo 0.54.0" />


  <link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="stylesheet" href="/assets/css/yarra.css">

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-63470225-3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-63470225-3');
  </script>

</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top site-navbar navbar-inverse">
  <a class="navbar-brand text-white" href="http://yarra-framework.org/">Yarra Framework</a>
  <button class="navbar-toggler text-white" 
  type="button" data-toggle="collapse" data-target="#exCollapsingNavbar2" aria-controls="exCollapsingNavbar2"
    aria-expanded="false" aria-label="Toggle navigation">
    &#9776;
  </button>
  <div class="collapse navbar-collapse" id="exCollapsingNavbar2">
    <ul class="nav navbar-nav ml-1 mr-auto">
               
        
        <li class="nav-item">
          <a class="nav-link menu-item " href="/overview">
            
            <span class="text-capitalize no-decoration text-white">Overview</span>
          </a>
        </li>
        
              
        
        <li class="nav-item">
          <a class="nav-link menu-item " href="/clients">
            
            <span class="text-capitalize no-decoration text-white">Clients</span>
          </a>
        </li>
        
              
        
        <li class="nav-item">
          <a class="nav-link menu-item " href="/server">
            
            <span class="text-capitalize no-decoration text-white">Server</span>
          </a>
        </li>
        
              
        
        <li class="nav-item">
          <a class="nav-link menu-item " href="/modules">
            
            <span class="text-capitalize no-decoration text-white">Modules</span>
          </a>
        </li>
        
              
        
        <li class="nav-item">
          <a class="nav-link menu-item " href="/logserver">
            
            <span class="text-capitalize no-decoration text-white">LogServer</span>
          </a>
        </li>
        
              
        
        <li class="nav-item">
          <a class="nav-link menu-item " href="/addons">
            
            <span class="text-capitalize no-decoration text-white">Addons</span>
          </a>
        </li>
        
              
        
        <li class="nav-item">
          <a class="nav-link menu-item " href="/download">
            
            <span class="text-capitalize no-decoration text-white">Download</span>
          </a>
        </li>
        
              
        
        <li class="nav-item">
          <a class="nav-link menu-item " href="/blog">
            
            <span class="text-capitalize no-decoration text-white">Blog</span>
          </a>
        </li>
        
              
        
              
        
              
        
      
    </ul>
  </div>
</nav>


<div class="container p-a-0">
  <div class="row m-l-0 m-r-0 mb-2">
    <div class="col">
      <h1>Modules core&nbsp;-&nbsp;SetDCMTags</h1>
    </div>
  </div>
    <div class="row m-l-0 m-r-0">
      <div class="col-xs-12 col-lg-3">
      <div class="list-group mr-3 mb-4">
        <a href="http://yarra-framework.org/modules_core/" class="list-group-item list-group-item-action">Overview</a>
        
        
        
        <a href="/modules_core/drivetransfer/" class="list-group-item list-group-item-action ">&ndash;&nbsp; DriveTransfer</a>
        
        <a href="/modules_core/inipatch/" class="list-group-item list-group-item-action ">&ndash;&nbsp; IniPatch</a>
        
        <a href="/modules_core/setdcmtags/" class="list-group-item list-group-item-action active">&ndash;&nbsp; SetDCMTags</a>
        
        <a href="/modules_core/pacstransfer/" class="list-group-item list-group-item-action ">&ndash;&nbsp; PACSTransfer</a>
        
      </div>
    </div>
    <div class="col-xs-12 col-lg-9 post-container">
      <div class="content pt-2">
  

<h4 id="purpose">Purpose</h4>

<p>Populates the DICOM tags of reconstructed images based on patient and scan information read from the Twix file. It also combines DICOM files into series based on the file name and sets the needed DICOM UUIDs.</p>

<h4 id="usage">Usage</h4>

<pre><code>SetDCMTags [options] input output rawfile
</code></pre>

<p>Parameters:<br></p>

<pre><code>  input   -- Folder with DICOM files to process
  output  -- Folder where modified DICOM files will be written
  rawfile -- Path and name of raw-data file
</code></pre>

<p>Options:<br></p>

<pre><code>  -a -- Accession number
  -t -- Path and name of task file
  -m -- Path and name of mode file
  -d -- Path and name of dynamic settings
  -l -- Extended log output for debugging
  -v -- Show version information and exit
</code></pre>

<p>Typical call:</p>

<pre><code>[PostProcessing]
Bin=%bd/SetDCMTags
Args=%pid %pod %rid/%rif -a %vacc -m %mc -t %rid/rit
</code></pre>

<h4 id="configuration">Configuration</h4>

<h5 id="file-naming-convention">File naming convention</h5>

<p>In order for SetDCMTags to correctly group images into series, the DICOMs written by the reconstruction module have to be named according to the syntax:</p>

<pre><code>series{n}.slice{m}.dcm
</code></pre>

<p>where <em>{n}</em> is the series # (e.g. time point, in case of 4D MRI data) and <em>{m}</em> is the slice number.</p>

<h5 id="global-options">Global options</h5>

<p>The following settings can be defined in the [SetDCMTags] section of the .mode file:</p>

<pre><code>[SetDCMTags]
SeriesOffset=        // Adds an offset to the series number
Color=               // Set to TRUE if the images are color images
ClearDefaults=       // Set to TRUE if the default tag assignment should not be used
SeriesMode=          // Set to TIME for 4D scans (i.e. if series are different time points)
FrameDuration=       // Defines the duration of one frame of the 4D dataset (in ms)
TimeOffset=          // Adds a time offset for the first frame (in ms)
InterleaveSeries=    // Set to TRUE if the order of series/slices should be swapped
StackSeries=         // Set to TRUE is all images should be stacked in one series
</code></pre>

<h5 id="adding-or-overwriting-tags">Adding or overwriting tags</h5>

<p>SetDCMTags sets most DICOM tags automatically. However, it is possible to overwrite the default assignment or to set additional tags:</p>

<pre><code>[SetDCMTags]
(n,m)=value
</code></pre>

<p>where <em>n</em>,<em>m</em> specifies the ID of the tag (see a list of all available DICOM tags <a href="https://www.dicomlibrary.com/dicom/dicom-tags/" target="_blank">here</a>).</p>

<p>Various macros can be used for setting the tags. Using the <strong>@</strong> operator, it is possible to reference values from the Twix file. For example, <strong>@PatientName</strong> returns the patient name. Values contained in the measurement protocol can be referenced using <strong>@mrpot</strong>. For example, <strong>@mrprot.adFlipAngleDegree[0]</strong> returns the flip angle of the first pulse. The original value of the DICOM tag can be accessed via <strong>#keep</strong> (thus, using #keep will preserve the original value instead of overwriting the DICOM tag).</p>

<p>Using the <strong>#</strong> operator, it is possible to access helper variables that are calculated by SetDCMTags. For example, <strong>#series</strong> returns the current series number. Using the <strong>$</strong> operator, helper functions can be called for manipulating the value: <strong>$EXT</strong> allows appending information. For example, <strong>$EXT(@ProtocolName,_modified)</strong> appends the string &ldquo;_modified&rdquo; to the protocol name. <strong>$DIV</strong> divides the value by an integer (as, e.g., needed when converting between ms and sec). For example, <strong>$DIV(@mrprot.alTE[0],1000,2)</strong> divides the TE time from the protocol by 1000 and keeps 2 digits.</p>

<p>The list of available helper variables can be seen in <a href="https://bitbucket.org/yarra-dev/yarramodules-setdcmtags/src/master/sdt_global.h" target="_blank">this file</a>, while the list of values parsed from the Twix file can be found on the bottom of <a href="https://bitbucket.org/yarra-dev/yarramodules-setdcmtags/src/master/sdt_twixreader.cpp" target="_blank">this file</a>. The default assignment that SetDCMTags uses can be seen in <a href="https://bitbucket.org/yarra-dev/yarramodules-setdcmtags/src/master/sdt_tagmapping.cpp" target="_blank">this file</a>.</p>

<h5 id="setting-series-specific-tags">Setting series-specific tags</h5>

<p>The values defined in the [SetDCMTags] section will be appied to all series. It is also possible to define values only for certain series. This can be done by adding a section to the .mode file where the series number is appended to the section name. In the following example, these settings would only be applied to series 2:</p>

<pre><code>[SetDCMTags_Series2]
(0008,103E)=$EXT(inphase_,@ProtocolName)
</code></pre>

<h5 id="setting-tags-dynamically">Setting tags dynamically</h5>

<p>Settings for SetDCMTags can be written into the .mode file, so that different settings can be defined for every reconstruction mode. However, sometimes it is necessary to set DICOM tags depending on the result of the indiviudal reconstruction. This is possible by writing these dynamic settings into a new text file that is created by the reconstruction module in the &ldquo;work&rdquo; folder %rid (where also the raw-data file is located). The name of the file has to be passed to SetDCMTags via the <em>-d</em> option. SetDCMTags then reads these settings as last step (overwriting all previously defined settings).</p>

</div>

      
    </div>
  </div>
</div>
      <footer style="margin-top: 100px;">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <ul class="list-inline pull-left">
                    
                         
                         
                          <li><a class="page-scroll" href="/">Home</a></li>
                          <li class="footer-menu-divider">&vert;</li> 
                        
                          <li><a class="page-scroll" href="/disclaimer/">Disclaimer</a></li>
                          <li class="footer-menu-divider">&vert;</li> 
                        
                          <li><a class="page-scroll" href="/license/">License</a></li>
                           
                         
                    
                </ul>
            </div>
            <div class="col-md-4">
            <div class="pull-right">
            <a href="http://cai2r.net" target="_blank"><img class="cai2rlogo" src="/assets/img/cai2r.png" height="65"></a>
            </div>
            </div>
        </div>
    </div>
</footer>

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha256-xaF9RpdtRxzwYMWg4ldJoyPWqyDPCRD0Cv7YEEe6Ie8=" crossorigin="anonymous"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>

<script>
hljs.configure({
  languages: []
})
hljs.initHighlightingOnLoad();
</script>

<script src="/assets/js/script.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
<script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'yarra-dev/Support'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>


  </body>
</html>

